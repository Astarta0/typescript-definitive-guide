<p>До текущей версии такие конструкции как генераторы (<code class="inline-code">generators</code>) имели недоработки косающиеся определения типа данных возвращаемых, как из, так и во внутрь генератора, значений.</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// пример со значением возвращающимся из генератора </span>

<span class="hljs-comment">// function generator(): IterableIterator&#x3C;"Done" | 100></span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">generator</span>(<span class="hljs-params"></span>) </span>{ 
    <span class="hljs-keyword">yield</span> <span class="hljs-number">100</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-string">`Done`</span>;
}

<span class="hljs-keyword">let</span> iterator = generator(); <span class="hljs-comment">// let iterator: IterableIterator&#x3C;"Done" | 100></span>
<span class="hljs-keyword">let</span> result = iterator.next(); <span class="hljs-comment">// let result: IteratorResult&#x3C;"Done" | 100></span>

<span class="hljs-comment">/**
 * Поскольку генератор перешел взавершенное состояние
 * значение result.value может принадлежать исключительно
 * к типу string ...
 */</span>
<span class="hljs-keyword">if</span> ( result.done ) {
    <span class="hljs-comment">/**
     * ... тем не менее, вывод типов определеяет его
     * как тип объединение (Union) string | number
     */</span>
    <span class="hljs-keyword">let</span> value = result.value; <span class="hljs-comment">// let value: string | number</span>
}</code></pre>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// пример со значением возвращаемым в генератор</span>

<span class="hljs-keyword">type</span> Greeter = {
    greet():<span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// function generator(): IterableIterator&#x3C;undefined></span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">generator</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">/**
     * В строке - let greeter: Greeter = yield;
     * предполагается, что возвращенное извнешнего кода
     * значение будетпринадлежать к типу Greeter...
     * 
     */</span>
    <span class="hljs-keyword">let</span> greeter: Greeter = <span class="hljs-keyword">yield</span>;
    greeter.greet();
}

<span class="hljs-keyword">let</span> iterator = generator(); <span class="hljs-comment">// let iterator: IterableIterator&#x3C;undefined></span>
iterator.next();
<span class="hljs-comment">/**
 * Строка ниже приведт кошибке во время выполнения
 * внутри  генератора при вызове метода greeter.greet();
 * поскольку возращенное значение принадлежит к типу number,
 * в то время как ожидается тип Greeter.
 */</span>
iterator.next(<span class="hljs-number">123</span>); <span class="hljs-comment">// Error, runtime error</span></code></pre>
<p>Начиная с версии <em>TypeScript</em> <code class="inline-code">3.6</code> описанные выше недостатки были устранены.</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// пример со значением возвращающимся из генератора </span>

<span class="hljs-comment">/**
 *  &#x3C;v3.6: function generator(): IterableIterator&#x3C;"Done" | 100>
 * >=v3.6: function generator(): Generator&#x3C;number, string, unknown>
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">generator</span>(<span class="hljs-params"></span>) </span>{ 
    <span class="hljs-keyword">yield</span> <span class="hljs-number">100</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-string">`Done`</span>;
}

<span class="hljs-comment">/**
 *  &#x3C;v3.6: let iterator: IterableIterator&#x3C;"Done" | 100>
 * >=v3.6: let iterator: Generator&#x3C;number, string, unknown>
 */</span>
<span class="hljs-keyword">let</span> iterator = generator();

<span class="hljs-comment">/**
 *  &#x3C;v3.6: let result: IteratorResult&#x3C;"Done" | 100>
 * >=v3.6: let result: IteratorResult&#x3C;number, string>
 */</span>
<span class="hljs-keyword">let</span> result = iterator.next();

<span class="hljs-keyword">if</span> ( result.done ) {
    <span class="hljs-comment">/**
     *  &#x3C;v3.6: let value: string | number
     * >=v3.6: let value: string
     */</span>
    <span class="hljs-keyword">let</span> value = result.value;
}</code></pre>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// пример со значением возвращаемым в генератор</span>

<span class="hljs-keyword">type</span> Greeter = {
    greet():<span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">/**
 *  &#x3C;v3.6: function generator(): IterableIterator&#x3C;undefined>
 * >=v3.6: function generator(): Generator&#x3C;undefined, void, Greeter>
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">generator</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> greeter: Greeter = <span class="hljs-keyword">yield</span>;
    greeter.greet();
}

<span class="hljs-comment">/**
 *  &#x3C;v3.6: let iterator: IterableIterator&#x3C;undefined>
 * >=v3.6: let iterator: Generator&#x3C;undefined, void, Greeter>
 */</span>
<span class="hljs-keyword">let</span> iterator = generator();
iterator.next();
iterator.next(<span class="hljs-number">123</span>); <span class="hljs-comment">// Error! Argument of type '[123]' is not assignable to parameter of type '[] | [Greeter]'.</span></code></pre>
<p>Подобноестало возможно благодаря добавлению шести новых типов перечисленных ниже, которые вы также можете использовать при работе с генераторами. </p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> Iterator&#x3C;T, TReturn = any, TNext = undefined> {<span class="hljs-comment">/** ... */</span>}
<span class="hljs-keyword">type</span> IteratorResult&#x3C;T, TReturn = <span class="hljs-built_in">any</span>> = IteratorYieldResult&#x3C;T> | IteratorReturnResult&#x3C;TReturn>;
<span class="hljs-keyword">interface</span> IteratorReturnResult&#x3C;TReturn> {<span class="hljs-comment">/** ... */</span>}
<span class="hljs-keyword">interface</span> IteratorYieldResult&#x3C;TYield> {<span class="hljs-comment">/** ... */</span>}

<span class="hljs-keyword">interface</span> Generator&#x3C;T = unknown, TReturn = any, TNext = unknown> <span class="hljs-keyword">extends</span> Iterator&#x3C;T, TReturn, TNext> {<span class="hljs-comment">/** ... */</span>}
<span class="hljs-keyword">interface</span> GeneratorFunction {<span class="hljs-comment">/** ... */</span>}
<span class="hljs-keyword">interface</span> GeneratorFunctionConstructor {<span class="hljs-comment">/** ... */</span>}</code></pre>
<p>И напоследок будет не лишним ещё раз взглянуть на очень простой и информативный пример более эффективной работы с генераторами.</p>
<pre><code class="hljs language-typescript"><span class="hljs-comment">/**
 * Generator&#x3C;number, string, boolean> 
 * или по другому
 * Generator&#x3C;
 *  возвращаемое с помощью оператора yield  значение,
 *  возвращаемое с помощью оператора return значение,
 *  передаваемое в метод next, то есть возвращаемое в генератор, значение
 * > 
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">counter</span>(<span class="hljs-params"></span>): <span class="hljs-title">Generator</span>&#x3C;<span class="hljs-title">number</span>, <span class="hljs-title">string</span>, <span class="hljs-title">boolean</span>> </span>{
    <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">yield</span> i++) {
            <span class="hljs-built_in">console</span>.log(
                <span class="hljs-string">`[if]  Block if in counter generator.
                       Variable value "i": <span class="hljs-subst">${i}</span>`</span>
            );
            
            <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">"Done"</span>;
}



<span class="hljs-keyword">let</span> iterator = counter();
<span class="hljs-keyword">let</span> result = iterator.next();


<span class="hljs-keyword">while</span> ( !result.done ) {
    <span class="hljs-keyword">let</span> returnedFromGeneratorValue = result.value;
    <span class="hljs-keyword">let</span> passedToGeneratorValue = returnedFromGeneratorValue === <span class="hljs-number">3</span>;
    
    <span class="hljs-built_in">console</span>.log( <span class="hljs-string">`[out] Returned from generator value: <span class="hljs-subst">${ returnedFromGeneratorValue }</span>`</span> );
    <span class="hljs-built_in">console</span>.log( <span class="hljs-string">`[in]  Passed to generator  value: <span class="hljs-subst">${ passedToGeneratorValue }</span>`</span> );
    
    result = iterator.next(passedToGeneratorValue);
}

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`[end] Return from generator resultant value: <span class="hljs-subst">${result.value.toUpperCase()}</span>`</span> );

<span class="hljs-comment">/**
 * "[out] Returned from generator value: 0"
 * "[in]  Passed to generator  value: false"
 * "[out] Returned from generator value: 1"
 * "[in]  Passed to generator  value: false"
 * "[out] Returned from generator value: 2"
 * "[in]  Passed to generator  value: true"
 * "[if]  Block if in counter generator.
          Variable value "i": 3"
 * "[end] Return from generator resultant value: DONE"
 */</span></code></pre>
