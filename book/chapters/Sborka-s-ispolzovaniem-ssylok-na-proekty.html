<section id="Ssylki-na-proekty" name="Ссылки на проекты" class="subchapter">
            <h2 class="subchapter-title">
                <button class="subchapter-title__button__copy-to-buffer copy-to-buffer" data="Ssylki-na-proekty" type="absolute-url">
                    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <use href="#icon_link"/>
                    </svg>
                </button>
                Ссылки на проекты
            </h2>
        
<hr>
<p>Начиная с версии <em>3.0</em>, в <em>TypeScript</em> стало возможным более эффективно работать с проектами за счет объединения множества зависимых проектов в общий процесс сборки. Это стало возможным за счет реализации функционала позволяющего ссылаться на другие проекты. Добавленный функционал упростил работу с так называемыми общими репозиториями, то есть, проектами, состоящими из отдельных, зависимых друг от друга и логически схожих, проектами. </p>
<p>Благодаря ссылкам на проекты значительно сократилось время сборки проекта. В этом компилятору <code class="inline-code">tsc</code> помогают алгоритмы  интеллектуальных инкрементальных сборок, которые компилируют только те части, которые в этом нуждаются. При том что под словом часть подразумевается не только фрагмент программы, но и отдельные проекты. Кроме того, ссылки на проекты, после сборки, повторяют исходную структуру связанных зависимостей, что немаловажно при работе с разбитыми на части проектами. Другими словами ссылки на проекты позволяют компилировать множество отдельных проектов собираемых по правилам описанных в <code class="inline-code">tsconfig.json</code> уникальных для каждого проекта, в результате чего будет получено множество завершенных частей программ (библиотеки, динамически подгружаемые части приложения, микросервисы). Добится подобного без использования ссылок на проекты невозможно, поскольку результатом обычной компиляции является только одна часть программы собранной по правилам одного конфигурационного файла.</p>
<p>Проект, который использует другие проекты в качестве своих зависимостей, должен указать ссылки на них в своем конфигурационном файле. Для этих целей в <code class="inline-code">tsconfig.json</code> существует специальное свойство верхнего уровня <code class="inline-code">references</code>. Свойство <code class="inline-code">references</code> ассоциируется с массивом объектов, поля которого описывают установки для связываемых проектов. Одним из ключевых полей является <code class="inline-code">path</code>, в качестве значения которого указывается ссылка на конфигурационный файл <code class="inline-code">tsconfig.json</code> проекта-зависимости, либо директорию, которая должна обязательно его содержать.</p>
<pre><code class="hljs language-typescript">{
 <span class="hljs-string">"references"</span>: [
   { <span class="hljs-string">"path"</span>: <span class="hljs-string">"path/to/tsconfig.json"</span> },
   { <span class="hljs-string">"path"</span>: <span class="hljs-string">"path/to/dir/with/tsconfig-json/"</span> }
 ]
}</code></pre>
<p>Важной деталью является то, что конфигурационный файл проекта выступающего в качестве зависимости обязан ведомлять об этом компилятор явным образом при помощи флага <code class="inline-code">composite</code> установленного в <code class="inline-code">true</code>.</p>
<pre><code class="hljs language-typescript">{
 <span class="hljs-string">"compilerOptions"</span>: {
   <span class="hljs-string">"composite"</span>: <span class="hljs-literal">true</span>
 }
}</code></pre>
<p>Данный флаг гарантирует активацию других параметров необходимых для более эффективной и быстрой работы поиска зависимостей. Активация флага composite переопределяет некоторое стандартное поведение. Так например, если параметр <code class="inline-code">rootDir</code> не установлен явно, то он будет ссылается на директорию содержащую конфигурационный файл <code class="inline-code">tsconfig.json</code>, в то время как обычно ссылается на директорию из которой был запущен процесс компиляции.</p>
<p>При разработке с использованием загружаемых через <code class="inline-code">npm</code> сторонних библиотек, в качестве источника информации о типах используются поставляемые в комплекте файлы декларации <code class="inline-code">.d.ts</code>. Разработчики могут бытьмв них уверены, так как после загрузки исходный код библиотек не изменяются. Когда в качестве зависимости выступает ссылка на проект, то изменение исходного кода является нормальной практикой. По этой причине, в качестве источников информации о типах используются сами файлы <code class="inline-code">.ts</code> или <code class="inline-code">.tsx</code> составляющих эти проекты, поскольку только таким образом можно быть уверенным, что работа происходит с актуальной версией.</p>
<p>Если исходный код проектов выступаемых в качестве зависимостей не подвержен частым изменениям, то сборку проекта можно ускорить за счет опции компилятора <code class="inline-code">disableSourceOfProjectReferenceRedirect</code>, установив которой значение <code class="inline-code">false</code>, уведомит компилятор об исключении из наблюдения файлов проекта и указания в качестве источников типов файлов деклараций <code class="inline-code">.d.ts</code>. Данная опция указывается в конфигурационном файле проекта выступающего в качестве зависимости. При этом нужно не забыть активировать саму генерацию деклараций установив флаг <code class="inline-code">declaration</code> в <code class="inline-code">true</code>.</p>
<pre><code class="hljs language-typescript">{
 <span class="hljs-string">"compilerOptions"</span>: {
   <span class="hljs-string">"disableSourceOfProjectReferenceRedirect"</span>: <span class="hljs-literal">true</span>,
   <span class="hljs-string">"declaration"</span>: <span class="hljs-literal">true</span>,
   <span class="hljs-string">"composite"</span>: <span class="hljs-literal">true</span>,

   <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"path/to/outdir/"</span>
 }</code></pre>
<p>Это ускорит процесс сборки\разработки, но потребует дополнительных усилий от разработчиков на пре-компиляцию, необъодимую для получения <code class="inline-code">.d.ts</code>. Кроме того процесс пересборки потребуется повторять при каждом изменении исходного кода проекта. Поэтому потребность в опции <code class="inline-code">disableSourceOfProjectReferenceRedirect</code> кажется разумной лишь на очень больших проектах.</p>
<p>Помимо перечисленного разработчики <em>TypeScript</em> добавили возможность для других инструментов сборки взаимодействовать с механизмом ссылок на проекты с помощью <em>API</em>. Это также будет неоценимо на крупных проектах, а для случаев работы над небольшими проектами, специально был добавлен новый флаг компилятора <code class="inline-code">--build</code>. </p>
<p>Команда компилятора <code class="inline-code">--build</code> ожидает перечисление конфигурационных файлов файлов и может быть использована совместно с такими специфичными для данной команды флагами, как <code class="inline-code">--verbose</code>, <code class="inline-code">--dry</code>, <code class="inline-code">--clean</code>  и <code class="inline-code">--force</code>.</p>
<p>Флаг <code class="inline-code">--verbose</code> выводит подробную информацию о сборке и может сочетаться с любыми другими флагами. Флаг <code class="inline-code">--dry</code> выполняет сборку не порождая выходные файлы. Флаг <code class="inline-code">--clean</code> удаляет выходные файлы соответствующие заданным входным. <code class="inline-code">--force</code> принудительно выполняет не инкрементальную сборку. Кроме того, команда <code class="inline-code">--build</code> может сочетаться с такой командой как <code class="inline-code">--watch</code>, которая, из всех специфичных для <code class="inline-code">--build</code> флагов, сочетается только с флагом <code class="inline-code">--verbose</code>.</p>
<p>Также не лишним будет упомянуть, что при использовании команды <code class="inline-code">--build</code> компилятор ведет себя так, будто опция <code class="inline-code">--noEmitOnError</code> установлена в <code class="inline-code">true</code>. Причина этому инкрементальная сборка, которая, при наличии ошибки в коде, выводит уведомления только при непосредственной компиляции, которая возникает исключительно при условии внесения изменения в компилируемый граф зависимостей, что может привести к трудно выявляемым багам. Ведь если разработчик, при возникновении множества ошибок, первым делом возьмется за устранение ошибок возникших в других зависимостях, об ошибках в коде, которого изменения не коснулись, компилятор сообщать уже не будет. Но несмотря на отсутствие ошибок в консоли, ошибки так и останутся в программе. </p>
</section>